<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_21) on Mon Sep 20 22:29:37 CEST 2010 -->
<TITLE>
RSA_mont_card
</TITLE>

<META NAME="date" CONTENT="2010-09-20">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="RSA_mont_card";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/RSA_mont_card.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../ds/ov2/front/RSA_host_card.html" title="class in ds.ov2.front"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../ds/ov2/front/RSA_plain_card.html" title="class in ds.ov2.front"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html?ds/ov2/front/RSA_mont_card.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="RSA_mont_card.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
ds.ov2.front</FONT>
<BR>
Class RSA_mont_card</H2>
<PRE>
<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</A>
  <IMG SRC="../../../resources/inherit.gif" ALT="extended by "><B>ds.ov2.front.RSA_mont_card</B>
</PRE>
<HR>
<DL>
<DT><PRE>public class <B>RSA_mont_card</B><DT>extends <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A></DL>
</PRE>

<P>
Protocol methods for the Montgomerizing RSA applet. The code here
 is very similar to <A HREF="../../../ds/ov2/front/RSA_plain_card.html" title="class in ds.ov2.front"><CODE>RSA_plain_card</CODE></A> and <A HREF="../../../ds/ov2/front/RSA_squared_card.html" title="class in ds.ov2.front"><CODE>RSA_squared_card</CODE></A>. There are however enough differences to make a
 gerneralized unified class a mess. All three applets, the
 Montgomerizing, the plain RSA and the squaring RSA applet are very
 similar. For simplicity even all protocol steps are identical
 (although not all of the data that is transfered during applet
 personalization is used in all applets). Most differences between
 the two applets are just treated by conditionals. Only for this
 class the differences are too big to cover them all nicely in
 conditionals. 
 <P>

 The Montgomerizing RSA applet computes everything on the JCVM,
 without using the crypto coprocessor. Everything is done with
 Montgomery muliplication. To spare some (de)montgomerizations on
 the card many numbers in the communication with the host are
 montgomerized. The applet needs no Montgomery correction factors,
 but it needs 2 Montgomery digits.
 <P>

 This class contains the methods that are called from the actions in
 the protocol steps. Some of the necessary temporary values are
 defined and allocated here. Most of the necessary data is however
 in <A HREF="../../../ds/ov2/front/RSA_data.html" title="class in ds.ov2.front"><CODE>RSA_data</CODE></A>. The temporary values defined here do not take
 part in the communication with the host. Therefore this class does
 not need to be present in the host driver. <P>

 The applet is always in one of four states, see the explanations in
 <A HREF="../../../ds/ov2/front/RSA_data.html" title="class in ds.ov2.front"><CODE>RSA_data</CODE></A>. 
 <P>

 All computations use solely Montgomery multiplication. Therefore
 everything (except for the exponents) has to be montgomerized. Data
 received from and sent to the host is Montgomerized too.
<P>

<P>
<DL>
<DT><B>CPP Preprocessing</B></DT>
  <DD>This class uses the following cpp defines:
   <a href="../../../overview-summary.html#PACKAGE">PACKAGE</a>,
   <a href="../../../overview-summary.html#PUBLIC">PUBLIC</a>,
   <a href="../../../overview-summary.html#ASSERT">ASSERT</a>,
   <a href="../../../overview-summary.html#RANDOM">RANDOM<a>,
   <a href="../../../overview-summary.html#RSA_EXPONENT">RSA_EXPONENT<a>,
   <a href="../../../overview-summary.html#JAVACARD_APPLET">JAVACARD_APPLET<a>,
   <a href="../../../overview-summary.html#MESSAGE_DIGEST">MESSAGE_DIGEST<a>,
   <a href="../../../overview-summary.html#HOST_TESTFRAME">HOST_TESTFRAME<a>,
   <a href="../../../overview-summary.html#APPLET_TESTFRAME">APPLET_TESTFRAME<a>,
   <a href="../../../overview-summary.html#CARD_SIGNATURE_ALWAYS_ACCEPT">CARD_SIGNATURE_ALWAYS_ACCEPT<a></DD>
<DT><B>Execution Environment:</B></DT>
  <DD>card</DD>
<DT><B>Author:</B></DT>
  <DD>Hendrik Tews</DD>
<DT><B>Version:</B></DT>
  <DD>$Revision: 1.8 $</DD>
<DT><B>Last Commit:</B></DT>
  <DD>$Date: 2009-06-18 11:57:39 $ by $Author: tews $</DD>
</DL>
<HR>

<P>
<!-- =========== FIELD SUMMARY =========== -->

<A NAME="field_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Field Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private &nbsp;<A HREF="../../../ds/ov2/bignat/Vector.html" title="class in ds.ov2.bignat">Vector</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#alphas">alphas</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Alphas and quotients.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>(package private) &nbsp;<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#beta_1">beta_1</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Random beta_1 from the resign protocol and beta from the proof
 protocoll.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>(package private) &nbsp;<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#beta_2">beta_2</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Random beta_2 from the resign protocol.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>(package private) &nbsp;<A HREF="../../../ds/ov2/front/RSA_data.html" title="class in ds.ov2.front">RSA_data</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#data">data</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Static data and data send and received from the host.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private &nbsp;<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#double_small">double_small</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Intermediate value of double small size.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>(package private) &nbsp;<A HREF="../../../ds/ov2/front/Front_protocols.html" title="class in ds.ov2.front">Front_protocols</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#front_protocols">front_protocols</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Registered protocols instance.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>(package private) &nbsp;<A HREF="http://www.cs.ru.nl/~woj/javacardapi221/javacard/security/MessageDigest.html?is-external=true" title="class or interface in javacard.security">MessageDigest</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#hash">hash</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message digest for computing 160 bit SHA-1.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;<A HREF="http://java.sun.com/javase/6/docs/api/java/io/PrintWriter.html?is-external=true" title="class or interface in java.io">PrintWriter</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#out">out</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug printer.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private &nbsp;<A HREF="http://www.cs.ru.nl/~woj/javacardapi221/javacard/security/RandomData.html?is-external=true" title="class or interface in javacard.security">RandomData</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#rand">rand</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Random number generator of type <a
 href="../../../overview-summary.html#RANDOM">RANDOM<a>.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>(package private) &nbsp;<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#sig_quotient">sig_quotient</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qutient d in the signature protocol.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private &nbsp;<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#temp_2">temp_2</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Temporary.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private &nbsp;<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#temp_3">temp_3</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Temporary.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private &nbsp;<A HREF="../../../ds/ov2/bignat/Vector.html" title="class in ds.ov2.bignat">Vector</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#temp_base_vec">temp_base_vec</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Temporary base vector of length 2.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>(package private) &nbsp;<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#temp_blinded_a">temp_blinded_a</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Temporary blinded attribute expression.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private &nbsp;<A HREF="../../../ds/ov2/bignat/Vector.html" title="class in ds.ov2.bignat">Vector</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#temp_exp_vec">temp_exp_vec</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Temporary exponent vector of length 2.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#RSA_mont_card(ds.ov2.front.RSA_data, ds.ov2.front.Front_protocols)">RSA_mont_card</A></B>(<A HREF="../../../ds/ov2/front/RSA_data.html" title="class in ds.ov2.front">RSA_data</A>&nbsp;data,
              <A HREF="../../../ds/ov2/front/Front_protocols.html" title="class in ds.ov2.front">Front_protocols</A>&nbsp;front_protocols)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Non-allocating constructor.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#allocate(short, short, short, short)">allocate</A></B>(short&nbsp;short_bignat_size,
         short&nbsp;long_bignat_size,
         short&nbsp;attribute_length,
         short&nbsp;mont_correction_len)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Allocate all data of the applet.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#finish_signature(ds.ov2.util.APDU_boolean)">finish_signature</A></B>(<A HREF="../../../ds/ov2/util/APDU_boolean.html" title="class in ds.ov2.util">APDU_boolean</A>&nbsp;accept)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Third step of the resign protocol.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#initialize()">initialize</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Initialize the plain RSA applet data structures.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#make_sig_hash()">make_sig_hash</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Second step of the resign protocol.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#proof_commit()">proof_commit</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;First step of the gate or proof protocol.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#respond_to_challenge()">respond_to_challenge</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Second step of the gate or proof protocol.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../ds/ov2/front/RSA_mont_card.html#switch_to_new_attributes(ds.ov2.util.APDU_boolean)">switch_to_new_attributes</A></B>(<A HREF="../../../ds/ov2/util/APDU_boolean.html" title="class in ds.ov2.util">APDU_boolean</A>&nbsp;success)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Atomically switch to various new values.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</A></CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->

<A NAME="field_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Field Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="front_protocols"><!-- --></A><H3>
front_protocols</H3>
<PRE>
<A HREF="../../../ds/ov2/front/Front_protocols.html" title="class in ds.ov2.front">Front_protocols</A> <B>front_protocols</B></PRE>
<DL>
<DD>Registered protocols instance. Needed here to update the
 protocol steps after resigning. (Resinging changes to new
 attributes, blindings, etc, by atomically switching references,
 see <A HREF="../../../ds/ov2/front/RSA_mont_card.html#switch_to_new_attributes(ds.ov2.util.APDU_boolean)"><CODE>switch_to_new_attributes</CODE></A>.)
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="data"><!-- --></A><H3>
data</H3>
<PRE>
<A HREF="../../../ds/ov2/front/RSA_data.html" title="class in ds.ov2.front">RSA_data</A> <B>data</B></PRE>
<DL>
<DD>Static data and data send and received from the host.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="temp_2"><!-- --></A><H3>
temp_2</H3>
<PRE>
private <A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A> <B>temp_2</B></PRE>
<DL>
<DD>Temporary. Used together with <A HREF="../../../ds/ov2/front/RSA_mont_card.html#temp_3"><CODE>temp_3</CODE></A> and <A HREF="../../../ds/ov2/front/RSA_data.html#result"><CODE>RSA_data.result</CODE></A> in various computations.
 <P>

 Long bignat.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="temp_3"><!-- --></A><H3>
temp_3</H3>
<PRE>
private <A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A> <B>temp_3</B></PRE>
<DL>
<DD>Temporary. Used together with <A HREF="../../../ds/ov2/front/RSA_mont_card.html#temp_2"><CODE>temp_2</CODE></A> and <A HREF="../../../ds/ov2/front/RSA_data.html#result"><CODE>RSA_data.result</CODE></A> in various computations.
 <P>

 Long bignat.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="alphas"><!-- --></A><H3>
alphas</H3>
<PRE>
private <A HREF="../../../ds/ov2/bignat/Vector.html" title="class in ds.ov2.bignat">Vector</A> <B>alphas</B></PRE>
<DL>
<DD>Alphas and quotients. Keeps the alphas in the proof step until
 the remainders and quotients are computed. At that point the
 alphas are not needed any more. Therefore, this vector is used
 immediately afterwards for the quotients. (The remainders go
 into <A HREF="../../../ds/ov2/front/RSA_data.html#remainders"><CODE>RSA_data.remainders</CODE></A>.) 
 <P>

 The last element with index <A HREF="../../../ds/ov2/front/RSA_data.html#attribute_length"><CODE>RSA_data.attribute_length</CODE></A>
 is always an alias of either <A HREF="../../../ds/ov2/front/RSA_data.html#v"><CODE>RSA_data.v</CODE></A> or <A HREF="../../../ds/ov2/front/RSA_data.html#gamma_beta_3"><CODE>RSA_data.gamma_beta_3</CODE></A>.
 <P>

 In the resign protocol the vector is not used except for its
 first entry (at index 0), which aliased under <A HREF="../../../ds/ov2/front/RSA_mont_card.html#sig_quotient"><CODE>sig_quotient</CODE></A> and which stores the quotient there.
 <P>

 Length <A HREF="../../../ds/ov2/front/RSA_data.html#attribute_length"><CODE>RSA_data.attribute_length</CODE></A> + 1. Filled with short
 bignats.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="double_small"><!-- --></A><H3>
double_small</H3>
<PRE>
private <A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A> <B>double_small</B></PRE>
<DL>
<DD>Intermediate value of double small size. This is the only
 double small bignat, with twice the size of the exponents. It
 is used in many places for intermediate results, especially
 where the exponents are manipulated and then a quotient and a
 remainder is computed. Also used for the attribute updates in
 the resign protocol.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="beta_1"><!-- --></A><H3>
beta_1</H3>
<PRE>
<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A> <B>beta_1</B></PRE>
<DL>
<DD>Random beta_1 from the resign protocol and beta from the proof
 protocoll. 
 <P>

 Long bignat.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="beta_2"><!-- --></A><H3>
beta_2</H3>
<PRE>
<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A> <B>beta_2</B></PRE>
<DL>
<DD>Random beta_2 from the resign protocol. Not used in the proof
 protocol. 
 <P>

 Long bignat.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="temp_blinded_a"><!-- --></A><H3>
temp_blinded_a</H3>
<PRE>
<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A> <B>temp_blinded_a</B></PRE>
<DL>
<DD>Temporary blinded attribute expression. In the resign protocol
 the attribute expression consisting of the new attributes and
 the old blinding is temporarily needed. 
 <P>

 Long bignat.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="sig_quotient"><!-- --></A><H3>
sig_quotient</H3>
<PRE>
<A HREF="../../../ds/ov2/bignat/Bignat.html" title="class in ds.ov2.bignat">Bignat</A> <B>sig_quotient</B></PRE>
<DL>
<DD>Qutient d in the signature protocol. (The remainder is in
 <A HREF="../../../ds/ov2/front/RSA_data.html#sig_remainder"><CODE>RSA_data.sig_remainder</CODE></A>). Alias of <A HREF="../../../ds/ov2/front/RSA_mont_card.html#alphas"><CODE>alphas</CODE></A>[0], which are otherwise not used during resigning.
 <P>

 Short bignat.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="rand"><!-- --></A><H3>
rand</H3>
<PRE>
private <A HREF="http://www.cs.ru.nl/~woj/javacardapi221/javacard/security/RandomData.html?is-external=true" title="class or interface in javacard.security">RandomData</A> <B>rand</B></PRE>
<DL>
<DD>Random number generator of type <a
 href="../../../overview-summary.html#RANDOM">RANDOM<a>.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="hash"><!-- --></A><H3>
hash</H3>
<PRE>
<A HREF="http://www.cs.ru.nl/~woj/javacardapi221/javacard/security/MessageDigest.html?is-external=true" title="class or interface in javacard.security">MessageDigest</A> <B>hash</B></PRE>
<DL>
<DD>Message digest for computing 160 bit SHA-1. Has type <a
 href="../../../overview-summary.html#MESSAGE_DIGEST">MESSAGE_DIGEST<a>.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="temp_base_vec"><!-- --></A><H3>
temp_base_vec</H3>
<PRE>
private <A HREF="../../../ds/ov2/bignat/Vector.html" title="class in ds.ov2.bignat">Vector</A> <B>temp_base_vec</B></PRE>
<DL>
<DD>Temporary base vector of length 2. Used in the resign and proof
 protocols to compute a multi-exponent of length 2. On the two
 locations the bases are completely differend and are, in part,
 temporary numbers. Therefore this base vector is only filled
 with aliases of other bignats. 
 <P>

 Contains precisely two aliases of long bignats.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="temp_exp_vec"><!-- --></A><H3>
temp_exp_vec</H3>
<PRE>
private <A HREF="../../../ds/ov2/bignat/Vector.html" title="class in ds.ov2.bignat">Vector</A> <B>temp_exp_vec</B></PRE>
<DL>
<DD>Temporary exponent vector of length 2. Used in the resign and
 proof protocols to compute a multi-exponent of length 2. On the
 two locations the exponents are completely differend and are,
 in part, temporary numbers. Therefore this base vector is only
 filled with aliases of other bignats. <P>

 Contains precisely two aliases of short bignats.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="out"><!-- --></A><H3>
out</H3>
<PRE>
public static <A HREF="http://java.sun.com/javase/6/docs/api/java/io/PrintWriter.html?is-external=true" title="class or interface in java.io">PrintWriter</A> <B>out</B></PRE>
<DL>
<DD>Debug printer. Used for debug messages in the <a
 href="../../../overview-summary.html#APPLET_TESTFRAME">APPLET_TESTFRAME<a>.
 Needs to be set from the outside.
<P>
<DL>
</DL>
</DL>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="RSA_mont_card(ds.ov2.front.RSA_data, ds.ov2.front.Front_protocols)"><!-- --></A><H3>
RSA_mont_card</H3>
<PRE>
public <B>RSA_mont_card</B>(<A HREF="../../../ds/ov2/front/RSA_data.html" title="class in ds.ov2.front">RSA_data</A>&nbsp;data,
                     <A HREF="../../../ds/ov2/front/Front_protocols.html" title="class in ds.ov2.front">Front_protocols</A>&nbsp;front_protocols)</PRE>
<DL>
<DD>Non-allocating constructor. Sets the <A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A> and <A HREF="../../../ds/ov2/front/RSA_mont_card.html#front_protocols"><CODE>front_protocols</CODE></A> fields. Sets the <a
 href="RSA_data.html#applet-state">State</a> to <A HREF="../../../ds/ov2/front/RSA_data.html#UNALLOCTED"><CODE>UNALLOCTED</CODE></A> when finished.
 Allocation of all the bignats and vectors has to be done
 explicitely with <A HREF="../../../ds/ov2/front/RSA_mont_card.html#allocate(short, short, short, short)"><CODE>allocate(short, short, short, short)</CODE></A>.
<P>
<DL>
<DT><B>Parameters:</B><DD><CODE>data</CODE> - the data instance<DD><CODE>front_protocols</CODE> - the protocols instance</DL>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="allocate(short, short, short, short)"><!-- --></A><H3>
allocate</H3>
<PRE>
public void <B>allocate</B>(short&nbsp;short_bignat_size,
                     short&nbsp;long_bignat_size,
                     short&nbsp;attribute_length,
                     short&nbsp;mont_correction_len)</PRE>
<DL>
<DD>Allocate all data of the applet. Main method of the only step
 in the allocate protocol. The object structure of the applet up
 to <A HREF="../../../ds/ov2/front/RSA_data.html" title="class in ds.ov2.front"><CODE>RSA_data</CODE></A> and this class is allocated during applet
 installation. Afterwards this method must be called in order to
 allocate all further data structures (mainly bignats and
 vectors). 
 <P>

 The decision whether to allocate the data in RAM (transient
 memory) or EEProm is hardwired here and in <A HREF="../../../ds/ov2/front/RSA_data.html#allocate(short, short, short, short, byte)"><CODE>RSA_data.allocate(short, short, short, short, byte)</CODE></A>. It works for cards with about 2K of RAM up
 to 1952 bit keys. If there is too little RAM or the key
 size is too big strange things will happen.
 <P>

 Asserts that the <a href="RSA_data.html#applet-state">state</a>
 is <A HREF="../../../ds/ov2/front/RSA_data.html#UNALLOCTED"><CODE>UNALLOCTED</CODE></A>. Sets the state to
 <A HREF="../../../ds/ov2/front/RSA_data.html#UNINITIALIZED"><CODE>UNINITIALIZED</CODE></A> when finished (see
 <A HREF="RSA_data.html#applet-state">applet state
 description</A>).
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>short_bignat_size</CODE> - size in bytes of the short (exponent) bignats<DD><CODE>long_bignat_size</CODE> - size in bytes of the long (base) bignats<DD><CODE>attribute_length</CODE> - number of attributes (without counting
 the blinding)<DD><CODE>mont_correction_len</CODE> - length of the <A HREF="../../../ds/ov2/front/RSA_data.html#montgomery_corrections"><CODE>data.montgomery_corrections</CODE></A> array</DL>
</DD>
</DL>
<HR>

<A NAME="initialize()"><!-- --></A><H3>
initialize</H3>
<PRE>
public void <B>initialize</B>()</PRE>
<DL>
<DD>Initialize the plain RSA applet data structures. This is the
 only action of the only step of the initialize protocol. It
 must be run after <A HREF="../../../ds/ov2/front/RSA_mont_card.html#allocate(short, short, short, short)"><CODE>allocation</CODE></A> and before the
 first resigning. 
 <P>

 Before this method is entered the OV-chip protocol layer
 transfers the following data as arguments of the initialize
 step into the right place:
 <UL>
 <LI>modulus <A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#n"><CODE>n</CODE></A></LI>
 <LI><A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#v"><CODE>v</CODE></A> (indirectly via <A HREF="../../../ds/ov2/front/RSA_data.html#current_attributes"><CODE>RSA_data.current_attributes</CODE></A>)</LI>
 <LI><A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#ptls_key"><CODE>ptls_key</CODE></A></LI>
 <LI><A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#bases"><CODE>bases</CODE></A></LI>
 <LI><A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#base_factors"><CODE>base_factors</CODE></A>
 </LI>
 <LI><A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#current_attributes"><CODE>current_attributes</CODE></A></LI>
 <LI><A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#current_blinding"><CODE>current_blinding</CODE></A> (indirectly via <A HREF="../../../ds/ov2/front/RSA_data.html#bases"><CODE>RSA_data.bases</CODE></A>)</LI>
 <LI><A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#montgomerized_one"><CODE>RSA_data.montgomerized_one</CODE></A>
 </LI>
 <LI><A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#montgomery_corrections"><CODE>montgomery_corrections</CODE></A></LI>
 </UL>
 <P>

 Asserts that the applet is in state <A HREF="../../../ds/ov2/front/RSA_data.html#UNINITIALIZED"><CODE>UNINITIALIZED</CODE></A>. After completion the
 state is set to <A HREF="../../../ds/ov2/front/RSA_data.html#INITIALIZED"><CODE>INITIALIZED</CODE></A> (see
 <A HREF="RSA_data.html#applet-state">applet state
 description</A>). <P>

 The source code of this method is affected by Brand's patents
 on selective disclosure protocols that are now in the posession
 of Microsoft. Microsoft lawyers are still pondering our request
 from January 2009 for making the full source code publically
 available. The source code of this method is therefore
 currently not publically available. The detailed operations of
 this method are:
 <DL>
 <DT><STRONG>check state</STRONG>
 <DD><a href="../../../overview-summary.html#ASSERT">ASSERT</a>
 that <A HREF="../../../ds/ov2/front/RSA_data.html#state"><CODE>RSA_data.state</CODE></A> contains <A HREF="../../../ds/ov2/front/RSA_data.html#UNINITIALIZED"><CODE>UNINITIALIZED</CODE></A> 
 <DT><STRONG>initialize digit masks <A HREF="../../../ds/ov2/front/RSA_data.html#mod_first_digit_mask"><CODE>RSA_data.mod_first_digit_mask</CODE></A>, <A HREF="../../../ds/ov2/front/RSA_data.html#v_first_digit_mask"><CODE>RSA_data.v_first_digit_mask</CODE></A></STRONG>
 <DD>with calling <A HREF="../../../ds/ov2/bignat/Bignat.html#get_first_digit_mask(short)"><CODE>Bignat.get_first_digit_mask</CODE></A>, an important subtlety here is
 that because of the <a
 href="../bignat/package-summary.html#montgomery_factor">Montgomery
 digits</a> the index of the first digit of the modulus in
 <A HREF="../../../ds/ov2/bignat/Modulus.html#m"><CODE>data.n.m</CODE></A> is 2.
 <DT><STRONG>Compute current blinded attribute expression <A HREF="../../../ds/ov2/front/RSA_data.html#current_blinded_a"><CODE>data.current_blinded_a</CODE></A></STRONG>
 <DD>compute <A HREF="../../../ds/ov2/front/RSA_data.html#bases"><CODE>data.bases</CODE></A>^<A HREF="../../../ds/ov2/front/RSA_data.html#current_attributes"><CODE>data.current_attributes</CODE></A> with
 <A HREF="../../../ds/ov2/bignat/Vector.html#mont_rsa_exponent_mod(ds.ov2.bignat.Vector, ds.ov2.bignat.Modulus, ds.ov2.bignat.RSA_exponent_interface, ds.ov2.bignat.Bignat, ds.ov2.bignat.Bignat, ds.ov2.bignat.Bignat, ds.ov2.bignat.Bignat)"><CODE>data.bases.mont_rsa_exponent_mod</CODE></A>. Because in this method the result
 and first temporary is used heavily in the multiplication, it
 is wise to use <A HREF="../../../ds/ov2/front/RSA_data.html#result"><CODE>data.result</CODE></A> as first
 temporary and <A HREF="../../../ds/ov2/bignat/Bignat.html#copy(ds.ov2.bignat.Bignat)"><CODE>copy</CODE></A> the result afterwards
 into <A HREF="../../../ds/ov2/front/RSA_data.html#current_blinded_a"><CODE>data.current_blinded_a</CODE></A>.
 Note that the <A HREF="../../../ds/ov2/front/RSA_data.html#current_blinding"><CODE>RSA_data.current_blinding</CODE></A> and the <A HREF="../../../ds/ov2/front/RSA_data.html#v"><CODE>RSA_data.v</CODE></A> are alias in the bases and current_attributes
 vector at index <A HREF="../../../ds/ov2/front/RSA_data.html#attribute_length"><CODE>RSA_data.attribute_length</CODE></A> + 1. Because
 of the blinding one has to use a montgomery correction factor
 for <code>data.attribute_length + 1</code> factors, see <A HREF="../../../ds/ov2/front/RSA_data.html#get_montgomery_correction(short)"><CODE>data.get_montgomery_correction</CODE></A>. 
 <DT><STRONG>advance the <A HREF="../../../ds/ov2/front/RSA_data.html#state"><CODE>RSA_data.state</CODE></A></STRONG>
 <DD>by setting it to <A HREF="../../../ds/ov2/front/RSA_data.html#INITIALIZED"><CODE>INITIALIZED</CODE></A>
 </DL>
 <P>

 There are no results sent back to the host by the OV-chip
 protocol layer after this method has finished.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="switch_to_new_attributes(ds.ov2.util.APDU_boolean)"><!-- --></A><H3>
switch_to_new_attributes</H3>
<PRE>
public void <B>switch_to_new_attributes</B>(<A HREF="../../../ds/ov2/util/APDU_boolean.html" title="class in ds.ov2.util">APDU_boolean</A>&nbsp;success)</PRE>
<DL>
<DD>Atomically switch to various new values. During the resign
 protocol the applet gets new attributes, chooses a new
 blinding, and computes the new blinded attribute expression and
 a new signature on it. To improve fault tolerance all these new
 data is stored in new_* variables, that are distinct form the
 current_* ones. At the end of the <A HREF="../../../ds/ov2/front/RSA_mont_card.html#finish_signature(ds.ov2.util.APDU_boolean)"><CODE>finish_signature</CODE></A> step of the resign protocol the new_*
 versions are atomically copied into the current_* ones. This is
 done in this method by swapping references. 
 <P>

 Swapping the references introduces a little problem in the
 protocol layer: The layer also has aliases for instance of 
 <A HREF="../../../ds/ov2/front/RSA_data.html#current_blinded_a"><CODE>RSA_data.current_blinded_a</CODE></A> and of <A HREF="../../../ds/ov2/front/RSA_data.html#current_signature"><CODE>RSA_data.current_signature</CODE></A>. After swapping references, these
 aliases suddenly alias invalid data. Therefore one has to
 uptate the step data structure with <A HREF="../../../ds/ov2/front/Front_protocols.html#update_steps()"><CODE>front_protocols.update_steps</CODE></A>. 
 <P>

 The source code of this method is affected by Brand's patents
 on selective disclosure protocols that are now in the posession
 of Microsoft. Microsoft lawyers are still pondering our request
 from January 2009 for making the full source code publically
 available. The source code of this method is therefore
 currently not publically available. The detailed operations of
 this method are:
 <DL>
 <DT><STRONG>Create temporaries</STRONG>
 <DD>Create 4 temporary references and initialize them to <A HREF="../../../ds/ov2/front/RSA_data.html#current_attributes"><CODE>data.current_attributes</CODE></A>, <A HREF="../../../ds/ov2/front/RSA_data.html#current_blinding"><CODE>data.current_blinding</CODE></A>, <A HREF="../../../ds/ov2/front/RSA_data.html#current_blinded_a"><CODE>data.current_blinded_a</CODE></A> and <A HREF="../../../ds/ov2/front/RSA_data.html#current_signature"><CODE>data.current_signature</CODE></A>,
 respectively.
 <DT><STRONG>Check side conditions</STRONG>
 <DD><a href="../../../overview-summary.html#ASSERT">ASSERT</a>
 that the argument <code>success</code> is still false and that
 <A HREF="../../../ds/ov2/front/RSA_data.html#new_attributes"><CODE>data.new_attributes</CODE></A> aliases
 <A HREF="../../../ds/ov2/front/RSA_data.html#v"><CODE>data.v</CODE></A> at index <A HREF="../../../ds/ov2/front/RSA_data.html#attribute_length"><CODE>data.attribute_length</CODE></A>.
 <DT><STRONG>Start a transaction</STRONG>
 <DD>with <A HREF="../../../ds/ov2/util/Misc.html#begin_transaction()"><CODE>Misc.begin_transaction()</CODE></A> in order to be
 compatible with the <a
 href="../../../overview-summary.html#HOST_TESTFRAME">HOST_TESTFRAME<a>
 <DT><STRONG>finish attribute swapping</STRONG>
 <DD>by writing the new_* references into the current_*
 variables and then by assigning the temporary references to the
 new_* variables.
 <DT><STRONG>update protocol step aliases</STRONG>
 <DD>with <A HREF="../../../ds/ov2/front/Front_protocols.html#update_steps()"><CODE>Front_protocols.update_steps()</CODE></A>
 <DT><STRONG>set state, mark success and commit</STRONG>
 <DD>set the state to <A HREF="../../../ds/ov2/front/RSA_data.html#BLINDED"><CODE>BLINDED</CODE></A> if it was <A HREF="../../../ds/ov2/front/RSA_data.html#INITIALIZED"><CODE>INITIALIZED</CODE></A>, set <code>success</code> to true
 and commit the 
 transaction with 
 <A HREF="../../../ds/ov2/util/Misc.html#commit_transaction()"><CODE>Misc.commit_transaction()</CODE></A>
 </DL>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>success</CODE> - alias of <A HREF="../../../ds/ov2/front/RSA_card_protocol_description.html#signature_accepted"><CODE>RSA_card_protocol_description.signature_accepted</CODE></A>, initially
 false, set to true when the atomic swapping succeeds</DL>
</DD>
</DL>
<HR>

<A NAME="make_sig_hash()"><!-- --></A><H3>
make_sig_hash</H3>
<PRE>
public void <B>make_sig_hash</B>()</PRE>
<DL>
<DD>Second step of the resign protocol. (In the first step no
 method is executed on the card, only <A HREF="../../../ds/ov2/front/RSA_data.html#applet_id"><CODE>RSA_data.applet_id</CODE></A>, <A HREF="../../../ds/ov2/front/RSA_data.html#current_blinded_a"><CODE>RSA_data.current_blinded_a</CODE></A> and
 <A HREF="../../../ds/ov2/front/RSA_data.html#current_signature"><CODE>RSA_data.current_signature</CODE></A> are sent to the host in the
 first step.) <P>

 Prior to calling this method the protocol layer receives
 <UL>
 <LI>the host commitment <A HREF="../../../ds/ov2/front/RSA_data.html#host_alpha"><CODE>RSA_data.host_alpha</CODE></A></LI>
 <LI>the attribute updates in <A HREF="../../../ds/ov2/front/RSA_data.html#remainders"><CODE>RSA_data.remainders</CODE></A>; these
 updates are in modulo format: to subract <code>x</code> from an
 attribute, the host sends <A HREF="../../../ds/ov2/front/RSA_data.html#v"><CODE>RSA_data.v</CODE></A><code>- x</code>.
 </UL>
 <P>

 After this method the protocol layer sends the remainder c in
 <A HREF="../../../ds/ov2/front/RSA_data.html#sig_remainder"><CODE>RSA_data.sig_remainder</CODE></A>.
 <P>

 Asserts that the applet is in state <A HREF="../../../ds/ov2/front/RSA_data.html#INITIALIZED"><CODE>INITIALIZED</CODE></A> or <A HREF="../../../ds/ov2/front/RSA_data.html#BLINDED"><CODE>BLINDED</CODE></A> (see <A
 HREF="RSA_data.html#applet-state">applet state
 description</A>). <P>

 The source code of this method is affected by Brand's patents
 on selective disclosure protocols that are now in the posession
 of Microsoft. Microsoft lawyers are still pondering our request
 from January 2009 for making the full source code publically
 available. The source code of this method is therefore
 currently not publically available. The detailed operations of
 this method are:
 <DL>
 <DT><STRONG>check state</STRONG>
 <DD><a href="../../../overview-summary.html#ASSERT">ASSERT</a>
 that the state is either <A HREF="../../../ds/ov2/front/RSA_data.html#INITIALIZED"><CODE>INITIALIZED</CODE></A> or <A HREF="../../../ds/ov2/front/RSA_data.html#BLINDED"><CODE>BLINDED</CODE></A>.
 <DT><STRONG>compute new attributes and store them in <A HREF="../../../ds/ov2/front/RSA_data.html#new_attributes"><CODE>RSA_data.new_attributes</CODE></A></STRONG>
 <DD>The addition of the current attribute value with the update
 might overflow, because of the modulo representation of the
 updates. Therefore, each attribute must be copied into <A HREF="../../../ds/ov2/front/RSA_mont_card.html#double_small"><CODE>double_small</CODE></A>, where the update is added and the
 remainder modulo <A HREF="../../../ds/ov2/front/RSA_data.html#v"><CODE>data.v</CODE></A> is taken. Finally
 the remainder in <A HREF="../../../ds/ov2/front/RSA_mont_card.html#double_small"><CODE>double_small</CODE></A> is copied into the
 <A HREF="../../../ds/ov2/front/RSA_data.html#new_attributes"><CODE>data.new_attributes</CODE></A>. The alias
 to <A HREF="../../../ds/ov2/front/RSA_data.html#v"><CODE>data.v</CODE></A> at index <A HREF="../../../ds/ov2/front/RSA_data.html#attribute_length"><CODE>data.attribute_length</CODE></A> in <A HREF="../../../ds/ov2/front/RSA_data.html#new_attributes"><CODE>data.new_attributes</CODE></A> must not be
 touched.
 <DT>XXXXXXXXXXXXXXXXXXX
 <DL>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="finish_signature(ds.ov2.util.APDU_boolean)"><!-- --></A><H3>
finish_signature</H3>
<PRE>
public void <B>finish_signature</B>(<A HREF="../../../ds/ov2/util/APDU_boolean.html" title="class in ds.ov2.util">APDU_boolean</A>&nbsp;accept)</PRE>
<DL>
<DD>Third step of the resign protocol. Prior to calling this method
 the protocol layer receives the host response r in <A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#host_response"><CODE>host_response</CODE></A>. After this
 method the protocol layer sends the boolean result of this
 method in <A HREF="../../../ds/ov2/front/RSA_card_protocol_description.html#signature_accepted"><CODE>RSA_card_protocol_description.signature_accepted</CODE></A>. 
 <P>

 Sets the state of the applet to <A HREF="../../../ds/ov2/front/RSA_data.html#BLINDED"><CODE>BLINDED</CODE></A> if it was <A HREF="../../../ds/ov2/front/RSA_data.html#INITIALIZED"><CODE>INITIALIZED</CODE></A>
 (see <A HREF="RSA_data.html#applet-state">applet state
 description</A>). <P>

 If the host response passes the acceptance check this method
 computes the final signature and starts a transaction to switch
 to the new attributes and the new signature. If all this goes
 through the result value in <code>accept</code> is set to true.
 Otherwise it remains false when this method finishes.
 <P>

 The source code of this method is affected by Brand's patents
 on selective disclosure protocols that are now in the posession
 of Microsoft. Microsoft lawyers are still pondering our request
 from January 2009 for making the full source code publically
 available. The source code of this method is therefore
 currently not publically available.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>accept</CODE> - reference to the accept result of this method,
 equal to <A HREF="../../../ds/ov2/front/RSA_card_protocol_description.html#signature_accepted"><CODE>RSA_card_protocol_description.signature_accepted</CODE></A>, 
 will be true when returning from this method precisely if the
 applet accepts the new signature and the transaction for
 changing to the new attributes and the new signature succeeded.</DL>
</DD>
</DL>
<HR>

<A NAME="proof_commit()"><!-- --></A><H3>
proof_commit</H3>
<PRE>
public void <B>proof_commit</B>()</PRE>
<DL>
<DD>First step of the gate or proof protocol. Prior to calling this
 method no arguments are received. After this method the
 protocol layer sends the following data to the host:
 <UL>
 <LI>the applet identifier <A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#applet_id"><CODE>applet_id</CODE></A> to let the host distinguish
 between the plain and the Montgomerizing applet,</LI>

 <LI>the current blinded attribute expression <A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#current_blinded_a"><CODE>current_blinded_a</CODE></A>,
 </LI>

 <LI>the current signature <A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#current_signature"><CODE>current_signature</CODE></A>, and</LI>

 <LI>the applet commitment w in <A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#result"><CODE>result</CODE></A></LI>
 </UL>
 <P>

 Asserts that the applet is in the state <A HREF="../../../ds/ov2/front/RSA_data.html#BLINDED"><CODE>BLINDED</CODE></A> (see <A HREF="RSA_data.html#applet-state">applet state
 description</A>). <P>

 The source code of this method is affected by Brand's patents
 on selective disclosure protocols that are now in the posession
 of Microsoft. Microsoft lawyers are still pondering our request
 from January 2009 for making the full source code publically
 available. The source code of this method is therefore
 currently not publically available.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="respond_to_challenge()"><!-- --></A><H3>
respond_to_challenge</H3>
<PRE>
public void <B>respond_to_challenge</B>()</PRE>
<DL>
<DD>Second step of the gate or proof protocol. Prior to calling
 this method the protocol layer receives the host challenge
 gamma in <A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#gamma_beta_3"><CODE>gamma_beta_3</CODE></A>. After this method the protocol layer sends the
 following data to the host:
 <UL>
 <LI>the remainders r_i in <A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#remainders"><CODE>remainders</CODE></A></LI>

 <LI>the applet response s in <A HREF="../../../ds/ov2/front/RSA_mont_card.html#data"><CODE>data</CODE></A>.<A HREF="../../../ds/ov2/front/RSA_data.html#result"><CODE>result</CODE></A></LI>
 </UL>
 <P>

 The source code of this method is affected by Brand's patents
 on selective disclosure protocols that are now in the posession
 of Microsoft. Microsoft lawyers are still pondering our request
 from January 2009 for making the full source code publically
 available. The source code of this method is therefore
 currently not publically available.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/RSA_mont_card.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../ds/ov2/front/RSA_host_card.html" title="class in ds.ov2.front"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../ds/ov2/front/RSA_plain_card.html" title="class in ds.ov2.front"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html?ds/ov2/front/RSA_mont_card.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="RSA_mont_card.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
